<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ุงูุชุญุงู ุงูููููุงุก โ ุงูุนูุงุตุฑ ุงูุงูุชูุงููุฉ</title>
<style>
  body{font-family:Tahoma, sans-serif;background:#f9f9fb;padding:18px}
  h1{text-align:center;margin-bottom:10px}
  .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.06);margin-bottom:12px}
  .timer{font-size:20px;color:#b71c1c;text-align:center;margin-bottom:12px}
  .options label{display:block;margin:6px 0;cursor:pointer}
  .login{max-width:520px;margin:8px auto;padding:12px;background:#fff;border-radius:10px}
  input[type=text]{padding:9px;width:100%;box-sizing:border-box;margin:6px 0}
  button{padding:10px 16px;border-radius:8px;border:none;background:#1976d2;color:#fff;cursor:pointer}
  .small{font-size:13px;color:#555}
  .hidden{display:none}
</style>
</head>
<body>
  <h1>ุงูุชุญุงู ุงูููููุงุก โ ุงูุนูุงุตุฑ ุงูุงูุชูุงููุฉ</h1>
  <div class="timer" id="timerDisplay">20:00</div>  
  <div class="login card" id="loginBox">
    <div class="small">ุฃุฏุฎู ุงูููุฏ (4 ุฃุฑูุงู) ูุงูู Student ID (11 ุฑูู) ูุจุฏุก ุงูุงูุชุญุงู.</div>
    <input type="text" id="codeInput" placeholder="ุงูููุฏ (ูุซุงู: 1234)" maxlength="4">
    <input type="text" id="studentIdInput" placeholder="Student ID - 11 ุฑูู" maxlength="11">
    <button id="startBtn">ุจุฏุก ุงูุงูุชุญุงู</button>
    <div id="loginMsg" class="small" style="color:red;margin-top:8px"></div>
  </div>  

  <form id="examForm" class="hidden">
    <!-- ุฃุณุฆูุฉ ุงูููููุงุก 13 -->
    <div class="card question">
      <p>1) ุนูุตุฑ ุชูุฒูุน ุฅููุชุฑููุงุชู ูู ุนุดุฑุฉ ูุณุชููุงุช ุทุงูุฉ ูุฑุนูุฉ ููุญุชูู ุขุฎุฑ ูุณุชูู ูุฑุนู ูู ุนูู ุฅููุชุฑูููู ููุฑุฏูู ูุฅูู ููุน ุถูู ุนูุงุตุฑ โฆโฆโฆ</p>
      <div class="options">
        <label><input type="radio" name="q1" value="A"> ุฃ) ุงูุณูุณูุฉ ุงูุงูุชูุงููุฉ ุงูุฑุฆูุณูุฉ ุงูุฃูููยยุงูุซุงููุฉ</label>
        <label><input type="radio" name="q1" value="B"> ุจ) ุงูุณูุณูุฉ ุงูุงูุชูุงููุฉ ุงูุฑุฆูุณูุฉ ุงูุซุงููุฉ ูุงููุฌููุนุฉ IIB</label>
        <label><input type="radio" name="q1" value="C"> ุฌ) ุงูุณูุณูุฉ ุงูุงูุชูุงููุฉ ุงูุฑุฆูุณูุฉ ุงูุซุงููุฉ ูุงููุฌููุนุฉ VIII</label>
        <label><input type="radio" name="q1" value="D"> ุฏ) ุงูุณูุณูุฉ ุงูุงูุชูุงููุฉ ุงูุฑุฆูุณูุฉ ุงูุซุงููุฉ ูุงููุฌููุนุฉ IVB</label>
      </div>
    </div>
    <div class="card question">
      <p>2) ุฅุฐุง ุนููุช ุฃู X ุนูุตุฑ ููุชูู ุชูุฒูุนู ุจู 3dยนโฐ ู Y ุงูุถุง ููุชูู ุชูุฒูุนู ุจู 3dยนโฐ ุ ูุฅุฐุง ุนููุช ุฃู ุนุฏุฏ ุงูุจุฑูุชููุงุช ูู Xยย> ุนุฏุฏูุง ูู Yุ ูุฃู ูู ุงูุขุชู ุตุญูุญุ</p>
      <div class="options">
        <label><input type="radio" name="q2" value="A"> ุฃ) X ูุณุชุฎุฏู ูู ุญูุงูุฉ ุงููุนุงุฏู ูู ุงูุชุขูู</label>
        <label><input type="radio" name="q2" value="B"> ุจ) X ูุฏุฎู ูู ูุตุงุจูุญ ุฃุจุฎุฑุฉ ุงูุฒุฆุจู</label>
        <label><input type="radio" name="q2" value="C"> ุฌ) ูุง ูุญุชูู ุนูู ุฅููุชุฑููุงุช ููุฑุฏุฉ</label>
        <label><input type="radio" name="q2" value="D"> ุฏ) ูุญุชูู ุนูู ุฅููุชุฑูู ููุฑุฏ ูู ุงููุณุชูู ุงููุฑุนู ุงูุฃุฎูุฑ</label>
      </div>
    </div>
    <div class="card question">
      <p>3) ูู ุฎูุงู ูุง ููู ุฅุฐุง ุนููุช ุฃู A, B, C ุซูุงุซุฉ ุนูุงุตุฑ ุงูุชูุงููุฉ: ุฃู ููุง ููู ุตุญูุญุ Aโบยณ ูุญุชูู ุนูู ุงูุตู ุนุฏุฏ ูู ุฅููุชุฑููุงุช ุงูููุฑุฏุฉ ูู ุงูู3d, Bโบยฒ ูุญุชูู ุนูู 3 ุฅููุชุฑููุงุช ููุฑุฏุฉ, Bโบยณ ูุญุชูู ุนูู 4 ุฅููุชุฑููุงุช ููุฑุฏุฉ, C ูุง ูุญุชูู ุนูู ุงููุชุฑูููุงุช ููุฑุฏู ูู ุงูุตู ุญุงูุงุช ุชุงูุณุฏ ููููุฉ</p>
      <div class="options">
        <label><input type="radio" name="q3" value="A"> ุฃ) C ูุฏ ูููู ุนูุตุฑ ูุฏุฎู ูู ุนูููุงุช ุชูููุฉ ููุงู ุงูุดุฑุจ</label>
        <label><input type="radio" name="q3" value="B"> ุจ) ูุฏ ูููู C ูู Sc , Ti , V , Cr , Mn , Zn</label>
        <label><input type="radio" name="q3" value="C"> ุฌ) A , B ูููุง ูุงุจููุฉ ูููุบูุทุฉ</label>
        <label><input type="radio" name="q3" value="D"> ุฏ) ุจ + ุฌ ุตุญูุญุชุงู</label>
      </div>
    </div>
    <div class="card question">
      <p>4) ุฅุฐุง ุนููุช ุฃู Xโบแดฎ . Y+แดฌ ุฃูููุงุช ูุนูุงุตุฑ ุงูุชูุงููุฉ ุชูุน ูู ุงูุณูุณูุฉ ุงูุฃููู ููุงู B> A ูุฃูููุงุช ูุฐู ุงูุนูุงุตุฑ ููุฌูุฏุฉ ูู ูุฑูุจุงุช ุชุนูู ูุนูุงูู ูุคูุณุฏู ูููู ูุฅู :</p>
      <div class="options">
        <label><input type="radio" name="q4" value="A"> ุฃ) Y = Cr ุ X = Mn ุ B = 7 ุ A = 6</label>
        <label><input type="radio" name="q4" value="B"> ุจ) Y = Mn ุ X = Cr ุ B = 6 ุ A = 7</label>
        <label><input type="radio" name="q4" value="C"> ุฌ) Y = Cr ุ X = Mn ุ B = 6 ุ A = 7</label>
        <label><input type="radio" name="q4" value="D"> ุฏ) Y = Mn ุ X = Cr ุ B = 7 ุ A = 6</label>
      </div>
    </div>
    <div class="card question">
      <p>5) ุฃู ูู ุงูุนูุงุตุฑ ุงูุขุชูุฉ ูู ุฃูู ุนุฒู ูุบูุงุทูุณูุ ุฅุฐุง ุนููุช ุฃู ูุฐู ุงูุนูุงุตุฑ ูุชุชุงุจุน ุงูุชูุงุก ุงููุณุชูู ุงููุฑุนู 3dุ</p>
      <div class="options">
        <label><input type="radio" name="q5" value="A"> ุฃ) ุนูุตุฑ ุงูุชูุงูู ูุฃุญุฏ ุฃูุงุณูุฏู XOโ ููุณุชุฎุฏู ูู ุตูุงุนุฉ ูุณุชุญุถุฑุงุช ุงูุชุฌููู</label>
        <label><input type="radio" name="q5" value="B"> ุจ) ุนูุตุฑ ูุดุฐู ูู ุงูุชูุฒูุน ุงูุฅููุชุฑููู ูุบูุฑ ูุดุท ููููุงุฆูุงู</label>
        <label><input type="radio" name="q5" value="C"> ุฌ) ุนูุตุฑ ูุดุฐู ูู ุงูุชูุฒูุน ุงูุฅููุชุฑููู ููุดุท ููููุงุฆูุงู</label>
        <label><input type="radio" name="q5" value="D"> ุฏ) ุฃูู ูู ุงููุชูุฉ ุงูุฐุฑูุฉ ูู ุงูุนูุตุฑ ุงูุฐู ูุณุจูู ูุงูุนูุตุฑ ุงูุฐู ูููู</label>
      </div>
    </div>
    <div class="card question">
      <p>6) ุฅุฐุง ุนููุช ุฃู A, B, C ุซูุงุซุฉ ุนูุงุตุฑ ุงูุชูุงููุฉ ูุชุชุงููุฉ ูููุนูุง ูู ุงูุณูุณูุฉ ุงูุงูุชูุงููุฉ ุงูุฃููู ููุงู A > B > C ูู ุงูุนุฏุฏ ุงูุฐุฑูุ ููุงู B ุฃูููู ูู ุงููุชูุฉ ุงูุฐุฑูุฉุ ูุฃู ูู ุงูุขุชู ุตุญูุญุ</p>
      <div class="options">
        <label><input type="radio" name="q6" value="A"> ุฃ) B < C ูู ุนุฏุฏ ุงูุฅููุชุฑููุงุช ุงููุฒุฏูุฌุฉ</label>
        <label><input type="radio" name="q6" value="B"> ุจ) C < B ูู ุงููุซุงูุฉ</label>
        <label><input type="radio" name="q6" value="C"> ุฌ) ุฌููุน ูุฑูุจุงุช ุงูุนูุตุฑ A ุฏุงูุง ูุบูุงุทูุณูุฉ</label>
        <label><input type="radio" name="q6" value="D"> ุฏ) ุจุนุถ ูุฑูุจุงุช ุงูุนูุตุฑ C ูุฏ ุชููู ุฏุงูุง ูุบูุงุทูุณูุฉ</label>
      </div>
    </div>
    <div class="card question">
      <p>7) ุฅุฐุง ุนููุช ุฃู A , B ุนูุตุฑุงู ุฅูุชูุงููุงู ูููุนุงู ูู ููุณ ุงููุฌููุนุฉ ูููู ุฃุญุฏููุง ูู ุงูุณูุณูุฉ n ูุงูุขุฎุฑ ูู ุงูุณูุณูุฉ n+2 ูุนูุฏ ุฎูุทููุง ูุชููู ุณุจููุฉ.ูุฃู ูู ุงูุขุชู ุตุญูุญุ</p>
      <div class="options">
        <label><input type="radio" name="q7" value="A"> ุฃ) A , B ูุดุชุฑูุงู ูู ุงูุชูุฒูุน ุงูุฅููุชุฑููู</label>
        <label><input type="radio" name="q7" value="B"> ุจ) A , B ููุงู ููููุง ูุง ูุณุชุทูุน ุชูููู ุณุจููุฉ ุจููููุฒูุฉ</label>
        <label><input type="radio" name="q7" value="C"> ุฌ) A ูุฏ ูููู Fe ู B ูุฏ ูููู Ni</label>
        <label><input type="radio" name="q7" value="D"> ุฏ) A ูุฏ ูููู ุนูุตุฑ ูุญุชูู ุนูู 2 ุฅููุชุฑูู ููุฑุฏ</label>
      </div>
    </div>
    <div class="card question">
      <p>8) ุฅุฐุง ุนููุช ุฃู: X โ ุนูุตุฑ ููุซู ูููู ุณุจููุฉ ูุน Y, Y โ ุนูุตุฑ ุฅูุชูุงูู ูููู ุณุจููุฉ ูุน ุงููููู, Z โ ุนูุตุฑ ููุซู ูููู ุณุจููุฉ ูุน ุงูููุฌููุฒ.ูุฃู ูู ุงูุขุชู ุตุญูุญุ</p>
      <div class="options">
        <label><input type="radio" name="q8" value="A"> ุฃ) Y ูุฏ ูุฏุฎู ูู ุตูุงุนุฉ ุงูุฃุตุจุน</label>
        <label><input type="radio" name="q8" value="B"> ุจ) Y ุนูุฏ ุฎูุทู ูุน X ูููู ุณุจููุฉ ุจูููุฉ</label>
        <label><input type="radio" name="q8" value="C"> ุฌ) X ูุน Y ููููุง ูุนุง ููุน ูุงุญุฏ ููุท ูู ุงูุณุจุงุฆู</label>
        <label><input type="radio" name="q8" value="D"> ุฏ) Z ูุณุชุทูุน ุนูู ุณุจููุฉ ุจููููุฒูุฉ ุนูุฏ ุฎูุทู ูุน ุงููููู</label>
      </div>
    </div>
    <div class="card question">
      <p>9) ูููู ุงูุญุตูู ุนูู ูุจุฑูุชุงุช ุงูุญุฏูุฏ II ูู ุฃุญุฏ ุงูุดูุงุฆุจ ุงูููุฌูุฏุฉ ูู ุฎุงูุงุช ุงูุญุฏูุฏ ูู ุฎูุงู โฆ</p>
      <div class="options">
        <label><input type="radio" name="q9" value="A"> ุฃ) ุฃูุณุฏุฉ ุชุงูุฉ ูู ูุฌูุฏ ูุญูุฒ โ ุฅุถุงูุฉ ูุงุก โ ุชูุงุนู ูุน ุญูุถ ูุงููุฌููู</label>
        <label><input type="radio" name="q9" value="B"> ุจ) ุฃูุณุฏุฉ ุชุงูุฉ ูู ูุฌูุฏ ูุญูุฒ โ ุฅุถุงูุฉ ูุงุก โ ุชูุงุนู ูุน ุญูุถ ุฃูุณููู</label>
        <label><input type="radio" name="q9" value="C"> ุฌ) ุฃูุณุฏุฉ ุชุงูุฉ ูู ูุฌูุฏ ูุญูุฒ โ ุฅุถุงูุฉ ูุงุก โ ุชูุงุนู ูุน ุจุฑุงุฏุฉ ุญุฏูุฏ</label>
        <label><input type="radio" name="q9" value="D"> ุฏ) ุฅุฎุชุฒุงู ุชุงู ูู ูุฌูุฏ ูุญูุฒ โ ุฅุถุงูุฉ ูุงุก โ ุชูุงุนู ูุน ุจุฑุงุฏุฉ ุญุฏูุฏ</label>
      </div>
    </div>
    <div class="card question">
      <p>10) ุฌููุน ุงูุชูุงุนูุงุช ุงูุขุชูุฉ ููุชุฌ ุนููุง ูุฑูุจุงุช ููุง ููุณ ุงูุนุฒู ุงููุบูุงุทูุณู ููููุจูุช ูู ุงููุฑูุจ CoClโ ูุง ุนุฏุง โฆ</p>
      <div class="options">
        <label><input type="radio" name="q10" value="A"> ุฃ) ุชุญููุต ูุฑุจููุงุช ุงูุญุฏูุฏ II</label>
        <label><input type="radio" name="q10" value="B"> ุจ) ุชูุงุนู ุงูุญุฏูุฏ ูุน ุญูุถ ุงููุจุฑูุชูู ุงููุฎูู</label>
        <label><input type="radio" name="q10" value="C"> ุฌ) ุชูุงุนู ุงูุญุฏูุฏ ูุน ุญูุถ ุงูููุฏุฑููููุฑูู ุงููุฎูู</label>
        <label><input type="radio" name="q10" value="D"> ุฏ) ุงูุฅูุญูุงู ุงูุญุฑุงุฑู ูุฃููุณุงูุงุช ุงูุญุฏูุฏ II ุจูุนุฒู ุนู ุงูููุงุก</label>
      </div>
    </div>
    <div class="card question">
      <p>11) ุชุนุฑุถ ุดุฎุต ูุญุงุฏุซ ู ุฃูุตู ุทุจูุจ ุงูุนุธุงู ุจุชุฑููุจ ุดุฑุงุฆุญ ู ูุณุงููุฑ ูุฌุจุฑ ุงููุณุฑ ุ ูุง ุงูุนูุตุฑ ุงูุฅูุชูุงูู ุงูุฐู ูุณุชุนูู ุจู ุงูุทุจูุจ ูู ูุฐู ุงูุนูููุฉุ</p>
      <div class="options">
        <label><input type="radio" name="q11" value="A"> ุฃ) ุงูุชูุชุงูููู</label>
        <label><input type="radio" name="q11" value="B"> ุจ) ุงูุญุฏูุฏ</label>
        <label><input type="radio" name="q11" value="C"> ุฌ) ุงููุงูุงุฏููู</label>
        <label><input type="radio" name="q11" value="D"> ุฏ) ุงูููุฌููุฒ</label>
      </div>
    </div>
    <div class="card question">
      <p>12) ูุง ุงูุนูุตุฑ ุงูุงูุชูุงูู ุงูุฃูู ูุซุงูุฉ ูู ุงูุตูุจ ู ุงูุฃูุซุฑ ุตูุงุจุฉ ููู ุนูุฏ ุชุณุฎูููุ</p>
      <div class="options">
        <label><input type="radio" name="q12" value="A"> ุฃ) ุงูุณูุงูุฏููู</label>
        <label><input type="radio" name="q12" value="B"> ุจ) ุงูุชูุชุงูููู</label>
        <label><input type="radio" name="q12" value="C"> ุฌ) ุงููุงูุงุฏููู</label>
        <label><input type="radio" name="q12" value="D"> ุฏ) ุงููููู</label>
      </div>
    </div>
    <div class="card question">
      <p>13) ุฃู ูู ุฃูุงุณูุฏ ุงูุนูุงุตุฑ ุงููุงูุนุฉ ูู ุงูุฏูุฑุฉ ุงูุฑุงุจุนุฉ ุชุณุชุฎุฏู ูููุงุฏ ููููุงุฆูุฉ ูู ุงูุนุฏูุฏ ูู ุงูููุชุฌุงุช ุงูุชุฌุงุฑูุฉ ุงููุงููุฉ ูู ุฃุดุนุฉ ุงูุดูุณุ</p>
      <div class="options">
        <label><input type="radio" name="q13" value="A"> ุฃ) TiOโ</label>
        <label><input type="radio" name="q13" value="B"> ุจ) CuO</label>
        <label><input type="radio" name="q13" value="C"> ุฌ) VโOโ</label>
        <label><input type="radio" name="q13" value="D"> ุฏ) MnOโ</label>
      </div>
    </div>

    <div style="text-align:center;margin-top:12px">
      <div class="small">* ูุง ุชุณูุญ ุจุงูุฏุฎูู ุฅูุง ุจููุฏ ุตุญูุญ ูุบูุฑ ูุณุชุฎุฏู</div>
      <button type="submit">ุฅุฑุณุงู ุงูุงูุชุญุงู</button>
    </div>
  </form>

<script>
const TELEGRAM_BOT_TOKEN = '8182981848:AAFESqf1hVM0JSEvywhXJdk5asGJlOq6q00';
const TELEGRAM_CHAT_ID = '7020597309';
const VALID_CODES = ["0478","0146","0348","0452","0509","0514","0561","0562","0789","0844",
"0893","0963","1041","1103","1179","1254","1327","1370","1491","1516",
"1548","1590","1642","1762","1839","1884","1920","2035","2140","2251",
"2330","2418","2546","2678","2743","2831","2950","3012","3129","3277",
"3344","3471","3553","3660","3721","3876","3904","4028","4170","4235",
"4311","4457","4570","4602","4729","4830","4912","5007","5140","5239",
"5361","5440","5509","5633","5777","5830","5931","6048","6112","6279",
"6374","6450","6511","6632","6745","6819","6950","7018","7133","7240",
"7371","7482","7590","7614","7728","7833","7945","8017","8130","8275",
"8336","8444","8559","8642","8770","8831","8940","9016","9132","9255",
"9340","9471","9582","9620","9743","9851","9960"];
const USED_CODES_KEY = 'usedExamCodes';
const CORRECT_ANSWERS = {q1:'C',q2:'B',q3:'C',q4:'D',q5:'B',q6:'B',q7:'A',q8:'B',q9:'C',q10:'A',q11:'A',q12:'C',q13:'A'};

let timerInterval = null;
let totalSeconds = 20*60;
let startTimestamp = null;
let currentCode = null;
let currentStudentId = null;

function loadUsedCodes(){ try{ return JSON.parse(localStorage.getItem(USED_CODES_KEY) || '[]'); }catch(e){ return []; } }
function saveUsedCode(code){ const arr = loadUsedCodes(); if(!arr.includes(code)) arr.push(code); localStorage.setItem(USED_CODES_KEY, JSON.stringify(arr)); }

function startTimer(){ 
  const display = document.getElementById('timerDisplay'); 
  const saved = sessionStorage.getItem(`exam_${currentCode}_start_${location.pathname}`); 
  if(saved){ 
    startTimestamp = parseInt(saved,10); 
    const elapsed = Math.floor((Date.now()-startTimestamp)/1000); 
    totalSeconds = Math.max(0, 20*60 - elapsed); 
  } else { 
    startTimestamp = Date.now(); 
    sessionStorage.setItem(`exam_${currentCode}_start_${location.pathname}`, String(startTimestamp)); 
  }
  timerInterval = setInterval(()=>{
    const m = Math.floor(totalSeconds/60).toString().padStart(2,'0'); 
    const s = (totalSeconds%60).toString().padStart(2,'0'); 
    display.textContent = `${m}:${s}`; 
    if(totalSeconds<=0){ 
      clearInterval(timerInterval); 
      alert('ุงูุชูู ุงูููุช! ุณูุชู ุฅุฑุณุงู ุงูุงูุชุญุงู ุชููุงุฆููุง.'); 
      submitExam(true); 
    } 
    totalSeconds--; 
  },1000); 
}

function collectAnswers(){ 
  const out={}; 
  for(let i=1;i<=13;i++){ 
    const el = document.querySelector(`input[name=q${i}]:checked`); 
    out['q'+i] = el ? el.value : ''; 
  } 
  return out; 
}

function computeResults(answers){ 
  let score=0; 
  const details={}; 
  for(const k in CORRECT_ANSWERS){ 
    const correct = CORRECT_ANSWERS[k]; 
    const chosen = answers[k] || ''; 
    const ok = chosen === correct; 
    details[k] = { chosen, correct, ok }; 
    if(ok) score++; 
  } 
  return {score, details}; 
}

function formatTelegramMessage(subject, studentId, code, answers, results, timeTakenSec){
  const now = new Date(); 
  let txt = `๐ *ุงูุชุญุงู: ${subject}*\n`; 
  txt += `๐ค Student ID: ${studentId}\n`; 
  txt += `๐ Code: ${code}\n`; 
  txt += `โฑ๏ธ ุงูููุช ุงููุฃุฎูุฐ: ${timeTakenSec} ุซุงููุฉ\n`; 
  txt += `๐ ููุช ุงูุฅุฑุณุงู: ${now.toLocaleString('ar-EG')}\n`; 
  txt += `\n*ุงูุชูุงุตูู:*\n`; 
  for(const q in results.details){ 
    const d = results.details[q]; 
    txt += `${q} - ุงุฎุชุฑ: ${d.chosen || '---'} | ุงูุตุญ: ${d.correct} => ${d.ok ? 'โ' : 'โ'}\n`; 
  } 
  txt += `\n*ุงููุชูุฌุฉ:* ${results.score} / 13\n`; 
  return txt; 
}

async function sendToTelegram(message){ 
  const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`; 
  try{ 
    const res = await fetch(url,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message, parse_mode: 'Markdown' })
    }); 
    return res.ok; 
  }catch(e){ console.error(e); return false; } 
}

async function submitExam(auto=false){ 
  const answers = collectAnswers(); 
  const results = computeResults(answers); 
  const now = Date.now(); 
  const timeTakenSec = Math.floor((now - startTimestamp)/1000); 
  const msg = formatTelegramMessage('ุงูููููุงุก โ ุงูุนูุงุตุฑ ุงูุงูุชูุงููุฉ', currentStudentId, currentCode, answers, results, timeTakenSec); 
  const ok = await sendToTelegram(msg); 
  if(ok){ 
    alert('ุชู ุฅุฑุณุงู ุงูุงูุชุญุงู ุฅูู ุงูุชูุฌุฑุงู.'); 
    saveUsedCode(currentCode); 
    sessionStorage.setItem(`exam_${currentCode}_submitted_${location.pathname}`, '1'); 
    document.getElementById('examForm').querySelectorAll('input,button').forEach(el=>el.disabled=true); 
    sessionStorage.removeItem(`exam_${currentCode}_start_${location.pathname}`); 
  }else{ 
    alert('ูุดู ูู ุฅุฑุณุงู ุงูุฑุณุงูุฉ. ุชุญูู ูู ุงูุชููู/Chat ID ุฃู ุงุชุตุงู ุงูุฅูุชุฑูุช.'); 
    if(!auto){ startTimer(); } 
  } 
}

document.getElementById('startBtn').addEventListener('click', ()=>{
  const code = (document.getElementById('codeInput').value || '').trim(); 
  const studentId = (document.getElementById('studentIdInput').value || '').trim(); 
  const msgEl = document.getElementById('loginMsg'); 
  msgEl.textContent = ''; 
  if(!/^\d{4}$/.test(code)){ msgEl.textContent = 'ุงูููุฏ ูุฌุจ ุฃู ูููู 4 ุฃุฑูุงู.'; return; } 
  if(!/^\d{11}$/.test(studentId)){ msgEl.textContent = 'Student ID ูุฌุจ ุฃู ูููู 11 ุฑููุงู.'; return; } 
  if(!VALID_CODES.includes(code)){ msgEl.textContent = 'ุงูููุฏ ุบูุฑ ุตุญูุญ.'; return; } 
  const used = loadUsedCodes(); 
  if(used.includes(code)){ msgEl.textContent = 'ูุฐุง ุงูููุฏ ูุณุชุฎุฏู ุจุงููุนู ููุง ูููู ุงูุฏุฎูู.'; return; } 
  if(sessionStorage.getItem(`exam_${code}_submitted_${location.pathname}`)){ msgEl.textContent = 'ุชู ุชุณููู ุงูุงูุชุญุงู ุณุงุจูุงู ุจุงุณุชุฎุฏุงู ูุฐุง ุงูููุฏ.'; return; } 
  currentCode = code; 
  currentStudentId = studentId; 
  document.getElementById('loginBox').classList.add('hidden'); 
  document.getElementById('examForm').classList.remove('hidden'); 
  startTimer(); 
});

document.getElementById('examForm').addEventListener('submit', function(e){ 
  e.preventDefault(); 
  clearInterval(timerInterval); 
  submitExam(false); 
});
</script>
</body>
</html>