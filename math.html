<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</title>
<style>
  body{font-family:Tahoma, sans-serif;background:#f4f6fa;padding:18px}
  h1{text-align:center;margin-bottom:8px}
  .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.08);margin-bottom:12px}
  .timer{font-size:20px;color:#b71c1c;text-align:center;margin-bottom:12px}
  .options label{display:block;margin:6px 0;cursor:pointer}
  .login{max-width:420px;margin:8px auto;padding:12px;background:#fff;border-radius:10px}
  input[type=text]{padding:9px;width:100%;box-sizing:border-box;margin:6px 0}
  button{padding:10px 16px;border-radius:8px;border:none;background:#1976d2;color:#fff;cursor:pointer}
  .small{font-size:13px;color:#555}
  .hidden{display:none}
</style>
</head>
<body>
  <h1>Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h1>
  <div class="timer" id="timerDisplay">15:00</div>  <div class="login card" id="loginBox">
    <div class="small">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ (4 Ø£Ø±Ù‚Ø§Ù…) ÙˆØ§Ù„Ù€ Student ID (11 Ø±Ù‚Ù…) Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†.</div>
    <input type="text" id="codeInput" placeholder="Ø§Ù„ÙƒÙˆØ¯ (Ù…Ø«Ø§Ù„: 1234)" maxlength="4">
    <input type="text" id="studentIdInput" placeholder="Student ID - 11 Ø±Ù‚Ù…" maxlength="11">
    <button id="startBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
    <div id="loginMsg" class="small" style="color:red;margin-top:8px"></div>
  </div>  <form id="examForm" class="hidden"><!-- Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª 10 -->
<div class="card question">
  <p>1) Ù…Ø§ Ù‚ÙŠÙ…Ø© 7 + 5 = ØŸ</p>
  <div class="options">
    <label><input type="radio" name="q1" value="A"> A) 11</label>
    <label><input type="radio" name="q1" value="B"> B) 12</label>
    <label><input type="radio" name="q1" value="C"> C) 13</label>
    <label><input type="radio" name="q1" value="D"> D) 10</label>
  </div>
</div>

<div class="card question">
  <p>2) 9 Ã— 3 = ØŸ</p>
  <div class="options">
    <label><input type="radio" name="q2" value="A"> A) 18</label>
    <label><input type="radio" name="q2" value="B"> B) 27</label>
    <label><input type="radio" name="q2" value="C"> C) 36</label>
    <label><input type="radio" name="q2" value="D"> D) 24</label>
  </div>
</div>

<div class="card question">
  <p>3) 15 Ã· 3 = ØŸ</p>
  <div class="options">
    <label><input type="radio" name="q3" value="A"> A) 3</label>
    <label><input type="radio" name="q3" value="B"> B) 4</label>
    <label><input type="radio" name="q3" value="C"> C) 5</label>
    <label><input type="radio" name="q3" value="D"> D) 6</label>
  </div>
</div>

<div class="card question">
  <p>4) Ù…Ø±Ø¨Ø¹ 6 = ØŸ</p>
  <div class="options">
    <label><input type="radio" name="q4" value="A"> A) 12</label>
    <label><input type="radio" name="q4" value="B"> B) 30</label>
    <label><input type="radio" name="q4" value="C"> C) 36</label>
    <label><input type="radio" name="q4" value="D"> D) 42</label>
  </div>
</div>

<div class="card question">
  <p>5) 100 - 45 = ØŸ</p>
  <div class="options">
    <label><input type="radio" name="q5" value="A"> A) 45</label>
    <label><input type="radio" name="q5" value="B"> B) 55</label>
    <label><input type="radio" name="q5" value="C"> C) 65</label>
    <label><input type="radio" name="q5" value="D"> D) 75</label>
  </div>
</div>

<div class="card question">
  <p>6) 2Â³ = ØŸ</p>
  <div class="options">
    <label><input type="radio" name="q6" value="A"> A) 6</label>
    <label><input type="radio" name="q6" value="B"> B) 8</label>
    <label><input type="radio" name="q6" value="C"> C) 4</label>
    <label><input type="radio" name="q6" value="D"> D) 9</label>
  </div>
</div>

<div class="card question">
  <p>7) 11 + 11 = ØŸ</p>
  <div class="options">
    <label><input type="radio" name="q7" value="A"> A) 20</label>
    <label><input type="radio" name="q7" value="B"> B) 21</label>
    <label><input type="radio" name="q7" value="C"> C) 22</label>
    <label><input type="radio" name="q7" value="D"> D) 23</label>
  </div>
</div>

<div class="card question">
  <p>8) 50% Ù…Ù† 200 = ØŸ</p>
  <div class="options">
    <label><input type="radio" name="q8" value="A"> A) 50</label>
    <label><input type="radio" name="q8" value="B"> B) 100</label>
    <label><input type="radio" name="q8" value="C"> C) 150</label>
    <label><input type="radio" name="q8" value="D"> D) 200</label>
  </div>
</div>

<div class="card question">
  <p>9) 3 + 4 Ã— 2 = ØŸ (Ø§ØªØ¨Ø¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª)</p>
  <div class="options">
    <label><input type="radio" name="q9" value="A"> A) 14</label>
    <label><input type="radio" name="q9" value="B"> B) 11</label>
    <label><input type="radio" name="q9" value="C"> C) 10</label>
    <label><input type="radio" name="q9" value="D"> D) 7</label>
  </div>
</div>

<div class="card question">
  <p>10) Ù‚ÙŠÙ…Ø© x Ø¥Ø°Ø§ ÙƒØ§Ù† 2x = 10 ØŸ</p>
  <div class="options">
    <label><input type="radio" name="q10" value="A"> A) 2</label>
    <label><input type="radio" name="q10" value="B"> B) 3</label>
    <label><input type="radio" name="q10" value="C"> C) 4</label>
    <label><input type="radio" name="q10" value="D"> D) 5</label>
  </div>
</div>

<div style="text-align:center;margin-top:12px">
  <div class="small">* Ù„Ø§ ØªØ³Ù…Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ø§ Ø¨ÙƒÙˆØ¯ ØµØ­ÙŠØ­ ÙˆØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…</div>
  <button type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
</div>

  </form><script>
/* ====== Ø¶Ø¹ Ø§Ù„ØªÙˆÙƒÙ† ÙˆChat ID Ù‡Ù†Ø§ ====== */
const TELEGRAM_BOT_TOKEN = '8182981848:AAFESqf1hVM0JSEvywhXJdk5asGJlOq6q00';
const TELEGRAM_CHAT_ID = '7020597309';
/* ================================== */

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù€100 Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (4 Ø£Ø±Ù‚Ø§Ù…)
const VALID_CODES = [
"0478","0146","0348","0452","0509","0514","0561","0562","0789","0844",
"0893","0963","1041","1103","1179","1254","1327","1370","1491","1516",
"1548","1590","1642","1762","1839","1884","1920","2035","2140","2251",
"2330","2418","2546","2678","2743","2831","2950","3012","3129","3277",
"3344","3471","3553","3660","3721","3876","3904","4028","4170","4235",
"4311","4457","4570","4602","4729","4830","4912","5007","5140","5239",
"5361","5440","5509","5633","5777","5830","5931","6048","6112","6279",
"6374","6450","6511","6632","6745","6819","6950","7018","7133","7240",
"7371","7482","7590","7614","7728","7833","7945","8017","8130","8275",
"8336","8444","8559","8642","8770","8831","8940","9016","9132","9255",
"9340","9471","9582","9620","9743","9851","9960"
];

// Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ†
const USED_CODES_KEY = 'usedExamCodes'; // ÙŠØ­ÙØ¸ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© (ØªÙØ®Ø²Ù† ÙƒÙ…ØµÙÙˆÙØ© JSON)

// Ø£Ø³Ø¦Ù„Ø© ÙˆØ¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø© (Ø§Ù„Ù‚ÙŠÙ… ØªÙ…Ø«Ù„ Ø§Ù„Ø­Ø±Ù Ø§Ù„ØµØ­ÙŠØ­ Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„)
const CORRECT_ANSWERS = { q1:'B', q2:'B', q3:'C', q4:'C', q5:'B', q6:'B', q7:'C', q8:'B', q9:'B', q10:'D' };

let timerInterval = null;
let totalSeconds = 15*60;
let startTimestamp = null; // Ø³ÙŠØ³Ø¬Ù„ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡
let currentCode = null;
let currentStudentId = null;

function loadUsedCodes(){
  try{
    return JSON.parse(localStorage.getItem(USED_CODES_KEY) || '[]');
  }catch(e){ return []; }
}
function saveUsedCode(code){
  const arr = loadUsedCodes();
  if(!arr.includes(code)) arr.push(code);
  localStorage.setItem(USED_CODES_KEY, JSON.stringify(arr));
}

function startTimer(){
  const display = document.getElementById('timerDisplay');
  // if session has remaining time (in case of reload)
  const saved = sessionStorage.getItem(`exam_${currentCode}_start_${location.pathname}`);
  if(saved){
    startTimestamp = parseInt(saved,10);
    const elapsed = Math.floor((Date.now()-startTimestamp)/1000);
    totalSeconds = Math.max(0, 15*60 - elapsed);
  } else {
    startTimestamp = Date.now();
    sessionStorage.setItem(`exam_${currentCode}_start_${location.pathname}`, String(startTimestamp));
  }

  timerInterval = setInterval(()=>{
    const m = Math.floor(totalSeconds/60).toString().padStart(2,'0');
    const s = (totalSeconds%60).toString().padStart(2,'0');
    display.textContent = `${m}:${s}`;
    if(totalSeconds<=0){
      clearInterval(timerInterval);
      alert('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.');
      submitExam(true);
    }
    totalSeconds--;
  },1000);
}

function collectAnswers(){
  const out={};
  for(let i=1;i<=10;i++){
    const el = document.querySelector(`input[name=q${i}]:checked`);
    out['q'+i] = el ? el.value : '';
  }
  return out;
}

function computeResults(answers){
  let score=0;
  const details={};
  for(const k in CORRECT_ANSWERS){
    const correct = CORRECT_ANSWERS[k];
    const chosen = answers[k] || '';
    const ok = chosen === correct;
    details[k] = { chosen, correct, ok };
    if(ok) score++;
  }
  return {score, details};
}

function formatTelegramMessage(subject, studentId, code, answers, results, timeTakenSec){
  const now = new Date();
  let txt = `ğŸ“˜ *Ø§Ù…ØªØ­Ø§Ù†: ${subject}*\n`;
  txt += `ğŸ‘¤ Student ID: ${studentId}\n`;
  txt += `ğŸ”‘ Code: ${code}\n`;
  txt += `â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø£Ø®ÙˆØ°: ${timeTakenSec} Ø«Ø§Ù†ÙŠØ©\n`;
  txt += `ğŸ•’ ÙˆÙ‚Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${now.toLocaleString('ar-EG')}\n`;
  txt += `\n*Ø§Ù„ØªÙØ§ØµÙŠÙ„:*\n`;
  for(const q in results.details){
    const d = results.details[q];
    txt += `${q} - Ø§Ø®ØªØ±: ${d.chosen || '---'} | Ø§Ù„ØµØ­: ${d.correct} => ${d.ok ? 'âœ…' : 'âŒ'}\n`;
  }
  txt += `\n*Ø§Ù„Ù†ØªÙŠØ¬Ø©:* ${results.score} / 10\n`;
  return txt;
}

async function sendToTelegram(message){
  const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
  try{
    const res = await fetch(url,{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message, parse_mode: 'Markdown' }) });
    return res.ok;
  }catch(e){ console.error(e); return false; }
}

async function submitExam(auto=false){
  // Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  const answers = collectAnswers();
  const results = computeResults(answers);
  const now = Date.now();
  const timeTakenSec = Math.floor((now - startTimestamp)/1000);
  const msg = formatTelegramMessage('Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', currentStudentId, currentCode, answers, results, timeTakenSec);

  // Ø£Ø±Ø³Ù„ Ù„Ù„ØªÙ„Ø¬Ø±Ø§Ù…
  const ok = await sendToTelegram(msg);
  if(ok){
    alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù….');
    // Ø³Ø¬Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…ÙØ³ØªØ®Ø¯Ù… ÙˆÙ…Ù…Ù†ÙˆØ¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
    saveUsedCode(currentCode);
    // Ù…Ù†Ø¹ Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© ØªØ§Ù†ÙŠØ© Ù„Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯
    sessionStorage.setItem(`exam_${currentCode}_submitted_${location.pathname}`, '1');
    // Ø§Ù‚ÙØ§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('examForm').querySelectorAll('input,button').forEach(el=>el.disabled=true);
    // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù„ÙˆÙ‚Øª
    sessionStorage.removeItem(`exam_${currentCode}_start_${location.pathname}`);
  }else{
    alert('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†/Chat ID Ø£Ùˆ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
    if(!auto){ // Ù„Ùˆ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙŠØ¯ÙˆÙŠ ÙˆÙ…Ø§ Ù†Ø¬Ø­ØŒ Ù†ØªØ±Ùƒ Ø§Ù„Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ù„Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© ØªØ§Ù†ÙŠØ©
      startTimer();
    }
  }
}

// Ø­Ø¯Ø« Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
document.getElementById('startBtn').addEventListener('click', ()=>{
  const code = (document.getElementById('codeInput').value || '').trim();
  const studentId = (document.getElementById('studentIdInput').value || '').trim();
  const msgEl = document.getElementById('loginMsg');
  msgEl.textContent = '';

  if(!/^\d{4}$/.test(code)){
    msgEl.textContent = 'Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 4 Ø£Ø±Ù‚Ø§Ù….'; return;
  }
  if(!/^\d{11}$/.test(studentId)){
    msgEl.textContent = 'Student ID ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 11 Ø±Ù‚Ù…Ø§Ù‹.'; return;
  }
  if(!VALID_CODES.includes(code)){
    msgEl.textContent = 'Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­.'; return;
  }
  const used = loadUsedCodes();
  if(used.includes(code)){
    msgEl.textContent = 'Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„.'; return;
  }
  // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ø³Ø¨Ù‚ ØªÙ‚Ø¯ÙŠÙ…Ù‡ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø³Ø§Ø± (submitted flag)
  if(sessionStorage.getItem(`exam_${code}_submitted_${location.pathname}`)){
    msgEl.textContent = 'ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø³Ø§Ø¨Ù‚Ø§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯.'; return;
  }

  // ÙƒÙ„ Ø´ÙŠØ¡ ØªÙ…Ø§Ù… - Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
  currentCode = code;
  currentStudentId = studentId;
  document.getElementById('loginBox').classList.add('hidden');
  document.getElementById('examForm').classList.remove('hidden');
  startTimer();
});

// Ø­Ø¯Ø« Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
document.getElementById('examForm').addEventListener('submit', function(e){
  e.preventDefault();
  clearInterval(timerInterval);
  submitExam(false);
});

// Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© - Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ (Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©)
(function(){
  // nothing else for now
})();

</script></body>
</html>